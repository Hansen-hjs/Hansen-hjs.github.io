<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
   <title>图片预加载</title>
   <style media="screen">
      *{ padding: 0; margin: 0; }
      li{ list-style: none;}
      img{ width: 100%; display: block;}
      #wrap{ max-width: 500px; margin: auto;}
      #wrap h2{ font-size: 28px; line-height: 50px; font-weight: 400; text-align: center;}
      .photos{ width: 100%; }
      .photos li{ margin-bottom: 20px;}
   </style>
</head>
<body>
   <div id="wrap">
      <h2>简单的图片预加载</h2>
      <ul class="photos">
         <li><img class="lazy" src="img/loading.gif" data-echo="img/big-1.jpg" alt=""></li>
         <li><img class="lazy" src="img/loading.gif" data-echo="img/big-2.jpg" alt=""></li>
         <li><img class="lazy" src="img/loading.gif" data-echo="img/big-3.jpg" alt=""></li>
         <li><img class="lazy" src="img/loading.gif" data-echo="img/big-4.jpg" alt=""></li>
         <li><img class="lazy" src="img/loading.gif" data-echo="img/big-5.jpg" alt=""></li>
         <li><img class="lazy" src="img/loading.gif" data-echo="img/big-6.jpg" alt=""></li>
         <li><img class="lazy" src="img/loading.gif" data-echo="img/big-7.jpg" alt=""></li>
      </ul>
   </div>
</body>
</html>
<script type="text/javascript">
window.Echo = (function(window, document, undefined) {
   'use strict';
   var store = [],
   offset,
   throttle,
   poll;
   var _inView = function(el) {
      var coords = el.getBoundingClientRect();
      return ((coords.top >= 0 && coords.left >= 0 && coords.top) <= (window.innerHeight || document.documentElement.clientHeight) + parseInt(offset));
   };
   var _pollImages = function() {
      for (var i = store.length; i--;) {
         var self = store[i];
         if (_inView(self)) {
            self.src = self.getAttribute('data-echo');
            store.splice(i, 1);
         }
      }
   };
   var _throttle = function() {
      clearTimeout(poll);
      poll = setTimeout(_pollImages, throttle);
   };
   var init = function(obj) {
      var nodes = document.querySelectorAll('[data-echo]');
      var opts = obj || {};
      offset = opts.offset || 0;
      throttle = opts.throttle || 250;

      for (var i = 0; i < nodes.length; i++) {
         store.push(nodes[i]);
      }
      _throttle();
      if (document.addEventListener) {
         window.addEventListener('scroll', _throttle, false);
      } else {
         window.attachEvent('onscroll', _throttle);
      }
   };
   return {
      init: init,
      render: _throttle
   };
})(window, document);

Echo.init({
	offset: 0,      //离可视区域多少像素的图片可以被加载
	throttle: 0,    //图片延时多少毫秒加载
});

</script>
