<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
   <title>深入JavaScript</title>
   <style>
      *{padding: 0; margin: 0;}
      #wrap{ width: 260px; height: 262px; color: #fff; margin: auto; position: absolute; top: 0; left: 0; right: 0; bottom: 0; line-height: 60px; text-align: center; transition: .4s all}
      #wrap p{ cursor: pointer;}
      .bgc{background: linear-gradient(to right, #22c1c3 , #fdbb2d);}
      .tra{background: linear-gradient(to right, #30E8BF , #FF8235);}
      .menu{ width: 100%; }
      .menu li{ width: 100%; height: 40px; text-align: center; line-height: 40px; color: #fff; background-color: #333; list-style: none; cursor: pointer;}
      .menu li:hover{ background: none; color: #333}
   </style>
</head>
<body>
   <div id="wrap" class="bgc">
      <p>探索JavaScript</p>
      <ul class="menu"></ul>
   </div>
</body>
</html>
<script type="text/javascript">
var $ = selector => document.querySelector(selector);
var $$ = selector => document.querySelectorAll(selector);
// $("#wrap").style.background = '#ccc';
// var objbox = document.getElementById('wrap');
/*
  阻止事件冒泡
  event.cancelBubble = true;

  addEventListener中的第三个参 数是useCapture,一个bool类型。
  当为false时为冒泡获取(由里向外)，true为capture方式(由外向里)

  等价于jQuery的 $(document).ready()
  addEventListener('DOMContentLoaded',functionName) // mouseover,mouseout:hover()
*/

var objbox = $('#wrap'), objP = objbox.querySelector('p'), list = $(".menu");
for (var i = 1; i <= 5; i++) {
  var item = document.createElement("LI");
  item.dataset.index = i;
  item.appendChild(document.createTextNode("测试li " + i));
  list.appendChild(item);
  // 不用let的传统写法，添加function完成闭包
  // (function (j) {
  //   // var j = i;
  //   item.addEventListener('click',() => {
  //     console.log("第" + j + "个li");
  //   });
  // })(i)
}
// 使用事假代理 (事件委托就是利用事件冒泡，只指定一个事件处理程序，就可以管理某一类型的所有事件)
list.addEventListener('click', (e) => {
  console.log(`第 ${e.target.dataset.index} 个li`);
});

// 正则表达式
function regular() {
  var phoneNum = '13265317656';
  var standard = /^1(3[0-9]|4[57]|5[0-35-9]|7[0135678]|8[0-9])\d{8}$/;
  // var aa = standard.exec(5).index
  if (standard.test(phoneNum)) {
    console.log('正确的手机号码');
  }else{
    console.log('错误的手机号码');
  }
}
// regular();

// 循环语句
var loopStatement = () => {
   let loopArr = new Array(); //  等价于 loopArr = []
   let testArr = [];
   let nameArr = ["字符串一","字符串二","字符串三","字符串四","字符串五","字符串六"];
   let valueArr = [];
   // for
   for (let i = 30; i <= 50; i++) {
      loopArr.push(i);
    }
    console.log(loopArr);
    // for in (循环数组和对象！)
    for (let test in loopArr) {
      testArr.push(test+':'+loopArr[test]);
    }
    console.log(testArr);
    // forEach (循环数组)
    nameArr.forEach((item, index) => {
      //  console.log(item, index);
      valueArr.push({
        name: item,
        type: 'line',
        data: loopArr[(index+1)]
      });
    });
    console.log(valueArr);
}
// loopStatement();

// 判断语句
function judge() {
   let j = 0, jArr = [], num1 = 7, num2 = 8;
  //  三元表达式 ?
   var max = (num1 > num2) ? num1 : num2;
   console.log(max);
   // while 循环判断
   while (j <= 5) {
      jArr.push(j);
      j++;
   }
   console.log(jArr);
   // switch
   let day = new Date().getDay();
   switch (day) {
      case 1:
        x = "Today it's Monday";
        break;
      case 2:
        x = "Today it's Tuesday";
        break;
      case 3:
        x = "Today it's Wednesday";
        break;
      case 4:
        x = "Today it's Thursday";
        break;
      case 5:
        x = "Today it's Friday";
        break;
      default:       // 如果不是以上情况，则会输出默认的消息：
        x = "Today it's Weenkend!";
   }
   console.log(x);
}
// judge();

// 时间生成器
function timeFunction() {
  timeInterval = (minInterval) => {   // minInterval 时间（5分钟间隔）
    var arr = [];
    var minTotal = 0;
    while (minTotal < 1440) {      // while 循环，如果（）内值为 true 时会一直循环执行
      var hour = parseInt(minTotal / 60);
      var min = parseInt(minTotal % 60);
      hour = hour < 10 ? `0${hour}` : hour;
      min = min < 10 ? `0${min}` : min;
      arr.push(`${hour}:${min}`);
      minTotal += minInterval;
    }
    return arr;
  }
  var timeArr = [];  // 定义一个数组
  timeArr = timeInterval(120);
  console.log(timeArr);
}
// timeFunction();


// new 理解
function newFunction() {
  function Animal(name){
    this.name = name;
  }
  Animal.color = "black";
  Animal.prototype.say = function(){  // prototype 向对象添加属性，此时 Animal.say() 不可用
    console.log("I'm " + this.name);
  };
  var cat = new Animal("cat");
  console.log(
    cat.name,       // cat
    cat.color       // undefined
  );
  cat.say();        // I'm cat

  console.log(
    Animal.name,    // Animal
    Animal.color    // back
  );
  Animal.say();     // Animal.say is not a function
  //上面的意思是：把 Animal 的作用赋值给了 cat ，
}
// newFunction();

// 对象
function objFunction(){
  // 1
  var Boy = {
    name:'Hansen',
    color:'lightgreen'
  };
  // 2
  var Boy = (name,color) => {
    return {
      name:name,
      color:color
    }
  }
  var cat = Boy('小米','黄色');
  var dog = Boy('华为','蓝色')
  console.log(cat,dog);
  // 3
  function Boy(name,color) {  // 这里不能用箭头函数
    this.name = name;
    this.color = color;
  }
  // var cat = new Boy('小米','黄色');
  // var dog = new Boy('华为','蓝色');
  // console.log(cat.name,dog);
}
// objFunction();

// 对象编程
var msg = new Object();
msg.al = (str) => {
  alert(str);
  msg.con(str);
}
msg.con = (str) => {
  console.log(str);
}
// 上面的写法等于
// var msg = {
//   al (str) {
//     alert(str);
//     msg.con(str); // 这里可以用this
//   },
//   con (str) {
//     console.log(str);
//   }
// }
msg.al('bb');

// class事件
function classFunction(){
  function hasClass(obj, cls) {
      return obj.className.match(new RegExp('(\\s|^)' + cls + '(\\s|$)'));
  }
  function addClass(obj, cls) {
      if (!hasClass(obj, cls)) {
          obj.className += ' '+cls;
      }
  }
  function removeClass(obj, cls) {
      if (hasClass(obj, cls)) {
          var reg = new RegExp('(\\s|^)' + cls + '(\\s|$)');
          obj.className = obj.className.replace(reg, '');
      }
  }
  function toggleClass(obj,cls){
      if(hasClass(obj,cls)){
          removeClass(obj, cls);
      } else {
          addClass(obj, cls);
      }
  }
  // IE10+
  // el.classList.contains(className);
  // el.classList.add(className);
  // el.classList.remove(className);
  // el.classList.toggle(className);
  objP.addEventListener('click',function(){
     toggleClass(objbox,'tra');
     // this.classList.toggle('tra');
  });
}
classFunction();

/*
ajax
url 请求地址
method 请求方式 GET POST
successHandler 请求成功时执行的方法
errorHandler 请求失败时执行的方法
sendData 传参 变量 = 'num=12'+'&id=12'
*/
function ajaxRequest(url, method, successHandler, errorHandler, sendData){
  var _data = '';
  // 解析对象传参
  if (typeof sendData != 'undefined') {
    let str = '';
    for (let key in sendData) {
      str += '&'+key+'='+sendData[key];
    }
    _data = str.slice(1);
  }
  // 检测请求类型
	if (window.fetch !== undefined) {
		fetch(url, {
			method: method,
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      body: _data
      // credentials: 'include' // 这个应该是跨域之后的 cookie 需要后台设置打开
		}).then((response) => {
			// console.log(response);
			// 将json数据转换成对象
			return response.json();
		}).then((indexContentData) => {
			if (successHandler !== undefined) {
				successHandler(indexContentData);
			}
		}).catch((error) => {
			if (errorHandler !== undefined) {
				errorHandler(error);
			}
		});
	} else {
    var xhr = new XMLHttpRequest();
    xhr.open(method, url);
    // xhr.responseType = 'json';
    xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = (event) => {
      var target = event.target;
      // console.log(1)
      if (target.readyState !== 4) {
        return
      }
      if (target.status === 200 || target.status === 304) {
        var indexContentData = JSON.parse(target.responseText);
        if (successHandler !== undefined) {
          successHandler(indexContentData);
        }
      } else {
        if (errorHandler !== undefined) {
          errorHandler(target.status);
        }
      }
    }
    xhr.send(_data);
	}
}


/*
永久储存
localStorage.setItem("key","value");//以“key”为名称存储一个值“value”
localStorage.getItem("key");//获取名称为“key”的值
周期储存（浏览器关闭之前）
sessionStorage.setItem('','')
sessionStorage.getItem('')
*/


// 数组处理
function contrast() {
  // 数组
  var arr = [23, 4, 4, 78, 3, 5, 1];
  /*
    arr.join('&')
    arr.split(',')
    arr.shift(); 移除第一项
    arr.unshift(); 在第一项添加
    arr.reverse(); 反转数组
    Math.ceil(25.9) 向上取舍
    Math.round(25.9) 四舍五入有
    Math.floor(25.9) 向下取舍
  */
  // arr.every() & arr.some() 历遍数
  var everyResult = arr.every(function(item, index, array){
   return (item > 2);
  });
  var someResult = arr.some(function(item, index, array){
   return (item > 2);
  });
  // arr.filter() 过滤一个数组
  var filterResult = arr.filter(function(item, index, array){
   return (item > 2);
  });
  // arr.map() 在原有数组中运行传入函数
  var mapResult = arr.map(function(item, index, array){
   return item * 2;
  });
  console.log(everyResult, someResult, filterResult, mapResult);
  var values = [1,2,3,4,5];
  // 数组累加 values.reduceRight() 反向执行
  var sum = values.reduce(function(prev, cur, index, array){
   return prev + cur;
  });
  console.log(sum);
  // 小到大
  function sab(x, y){
    if (x < y) {
      return -1;
    } else if (x > y) {
      return 1;
    } else {
      return 0;
    }
  }
  // 大到小
  function bas(x, y){
    if (x > y) {
      return -1;
    } else if (x < y) {
      return 1;
    } else {
      return 0;
    }
  }
  console.log(arr.sort(bas));
  // 数组对象
  let arrObj = [{name: "zlw", age: '24'}, {name: "wlz", age: '50'},{name: "hjs", age: '15'}];
  let compare = function (prop) {
    return function (obj1, obj2) {
      let val1 = obj1[prop];
      let val2 = obj2[prop];
      if (!isNaN(Number(val1)) && !isNaN(Number(val2))) {
        val1 = Number(val1);
        val2 = Number(val2);
      }
      if (val1 < val2) {
        return -1;
      } else if (val1 > val2) {
        return 1;
      } else {
        return 0;
      }
    }
  }
  console.log(arrObj.sort(compare("age")));
  var num = 99;
  console.log(num.toFixed(2),num.toPrecision(3));
  // 思考
  // function createFunctions(){
  //   var result = new Array();
  //   for (var i = 0; i < 10; i++){
  //     result[i] = function(){
  //       return i;
  //     };
  //   }
  //   return result;
  // }
  function createFunctions(){
    var result = new Array();
    for (var i = 0; i < 10; i++){
      result[i] = function(num){
        return function(){
          return num;
        };
      }(i);
    }
    return result;
  }
  console.log(createFunctions());
}
// contrast();
</script>
